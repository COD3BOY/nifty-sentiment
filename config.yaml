# NIFTY Sentiment Prediction System Configuration

sources:
  gift_nifty:
    enabled: true
    weight: 2.5
    timeout: 30
    description: "GIFT Nifty pre-market gap"
    gap_pct_scale: 2.0  # 1% gap maps to 0.5 score

  zerodha_pulse:
    enabled: true
    weight: 2.0
    timeout: 30
    description: "News sentiment via Zerodha Pulse"
    max_headlines: 20
    rss_url: "https://pulse.zerodha.com/feed.php"

  global_markets:
    enabled: true
    weight: 2.0
    timeout: 30
    description: "S&P 500, Nikkei, Hang Seng, FTSE"
    indices:
      "^GSPC": { name: "S&P 500", weight: 1.0 }
      "^N225": { name: "Nikkei 225", weight: 0.7 }
      "^HSI": { name: "Hang Seng", weight: 0.7 }
      "^FTSE": { name: "FTSE 100", weight: 0.5 }

  fii_dii:
    enabled: true
    weight: 1.8
    timeout: 30
    description: "FII/DII institutional flows"
    significant_flow_cr: 2000
    fii_weight: 0.7
    dii_weight: 0.3

  vix:
    enabled: true
    weight: 1.5
    timeout: 30
    description: "India VIX fear gauge"
    ticker: "^INDIAVIX"
    spike_threshold: 10  # % day-over-day rise
    spike_amplification: 0.3

  crude_oil:
    enabled: true
    weight: 1.0
    timeout: 30
    description: "Brent crude + USD/INR"
    crude_ticker: "BZ=F"
    inr_ticker: "INR=X"
    crude_weight: 0.6
    inr_weight: 0.4

  youtube:
    enabled: false
    weight: 0.8
    timeout: 60
    description: "YouTube financial advisor sentiment"
    channels:
      - "CA Rachana Ranade"
      - "Akshat Shrivastava"
      - "Pranjal Kamra"

  reddit:
    enabled: false
    weight: 0.5
    timeout: 30
    description: "r/IndianStreetBets sentiment"
    subreddit: "IndianStreetBets"
    post_limit: 25
    confidence_discount: 0.7

engine:
  default_timeout: 30
  nifty_ticker: "^NSEI"
  sentiment_levels:
    strongly_bearish: -0.6
    bearish: -0.3
    slightly_bearish: -0.1
    neutral_low: -0.1
    neutral_high: 0.1
    slightly_bullish: 0.1
    bullish: 0.3
    strongly_bullish: 0.6

database:
  path: "data/nifty_sentiment.db"

claude:
  model: "claude-sonnet-4-5-20250929"
  max_tokens: 4096

pre_market:
  weights:
    gift_nifty: 3.0
    global_markets: 2.5
    zerodha_pulse: 2.0
    fii_dii: 1.8
    vix: 1.5
    crude_oil: 1.0

options_desk:
  symbol: "NIFTY"
  nifty_ticker: "^NSEI"
  candles:
    period: "5d"
    interval: "5m"
  indicators:
    ema_fast: 9
    ema_mid: 21
    ema_slow: 50
    rsi_period: 9
    supertrend_period: 10
    supertrend_multiplier: 3.0
    bb_period: 20
    bb_std: 2.0
  iv_calculator:
    risk_free_rate: 0.065    # RBI repo rate (annual, decimal)
    atm_range: 15            # Compute IV for ± this many strikes around ATM
  signal_thresholds:
    rsi_overbought: 70
    rsi_oversold: 30
    pcr_bullish: 1.2
    pcr_bearish: 0.7
    iv_high: 18
    iv_low: 10
  trade_suggestions:
    lot_size: 65
    otm_offset: 2
    spread_width: 2
    min_score: 40
    context_adjustments:
      enabled: true
      vol_sell_premium_bonus: 10
      vol_stand_down_penalty: -10
      vol_buy_premium_penalty: -5
      rv_expanding_penalty: -5
      rv_contracting_bonus: 5
      trend_alignment_bonus: 5
      trend_conflict_penalty: -5
      prior_day_doji_bonus: 5
      prior_day_wide_range_penalty: -5
      prior_day_wide_range_pct: 2.0
      session_range_bound_bonus: 5
      session_wide_range_penalty: -5
      session_wide_range_pct: 1.5
      session_ema_alignment_bonus: 5
      session_ema_neutral_penalty: -3
      session_rsi_momentum_bonus: 3
      session_bb_reversal_bonus: 3
      session_vwap_confirmation_bonus: 3
      session_vwap_threshold_pct: 0.3
      observation_bias_bonus: 5
      observation_neutral_bonus: 3
      weekly_trend_bonus: 3
      regime_stability_bonus: 3
      regime_stability_min_days: 3
      regime_instability_penalty: -3
      regime_instability_threshold: 4
      consecutive_day_bonus: 3
      consecutive_day_threshold: 3

paper_trading:
  initial_capital: 5000000
  lot_size: 65
  auto_execute: true
  min_score_to_trade: 50
  debit_min_score_to_trade: 70
  standdown_min_score_bump: 10
  reentry_after_pt_cooldown_minutes: 30
  context_exit_enabled: true
  context_exit_range_pct: 1.2
  context_exit_min_hold_minutes: 15
  debit_context_unlock_threshold: 55
  trade_cooldown_seconds: 60
  max_lots: 4
  capital_utilization: 0.70
  daily_loss_limit_pct: 3.0
  debit_max_hold_minutes: 300
  eod_close_time: "15:20"
  entry_start_time: "10:00"         # Warmup 9:15-10:00 — collect data before trading
  entry_cutoff_time: "15:10"
  observation:
    gap_threshold_pct: 0.2           # ±0.2% to classify as gap_up/gap_down
    trend_moderate_pct: 0.3          # 0.3% move = moderate trend
    trend_strong_pct: 0.7            # 0.7% move = strong trend
    volume_high_ratio: 1.3           # >1.3x typical = high volume
    volume_low_ratio: 0.7            # <0.7x typical = low volume
    vwap_consistency_pct: 70.0       # 70%+ bars above/below = consistent
    historical_days: 5               # days of data for volume comparison
  max_open_positions: 3
  max_trades_per_day: 6
  max_positions_per_direction: 2
  max_staleness_minutes: 20
  slippage_per_leg: 3.0
  stop_loss:
    credit_fallback_multiplier: 1.5
    debit_premium_pct: 0.35
  profit_target:
    credit_pct: 0.30
    debit_pct: 0.50
  execution_cost:
    brokerage_per_order: 20
    stt_sell_pct: 0.001
    exchange_txn_pct: 0.00035
    sebi_turnover_pct: 0.000001    # ₹10/crore on total turnover
    gst_pct: 0.18
    stamp_duty_buy_pct: 0.00003
  expiry_guards:
    no_new_after_minutes_before_close: 30   # Don't open positions in last 30min on expiry day
    min_leg_premium: 2.0                    # Skip legs with LTP < ₹2
    min_net_premium_per_lot: 100            # Skip if |net premium| per lot < ₹100

  notifications:
    browser_enabled: true
    toast_enabled: true

  margin_estimates:
    short_straddle: 150000
    short_strangle: 135000
    bull_put_spread: 65000
    bear_call_spread: 65000
    bull_call_spread: 0
    bear_put_spread: 0
    iron_condor: 45000
    long_call_ce: 0
    long_put_pe: 0
    long_straddle: 0
    long_strangle: 0

algorithms:
  sentinel:
    enabled: true
    display_name: "V1 Sentinel"
  optimus:
    enabled: true
    display_name: "V3 Optimus"
    # Capital
    initial_capital: 5000000
    lot_size: 65
    # Section 1 — Risk limits
    max_risk_per_trade_pct: 0.5
    max_portfolio_risk_pct: 3.0
    max_margin_utilization_pct: 25.0
    daily_loss_shutdown_pct: 1.25
    weekly_drawdown_shutdown_pct: 2.0
    consecutive_loss_reduce_threshold: 3
    consecutive_loss_halt: 5
    # Section 2 — Allocation
    primary_allocation_pct: 80.0
    secondary_allocation_pct: 20.0
    max_iron_condors: 3
    max_directional_positions: 1
    # Section 3A — Credit regime
    credit_min_iv_percentile: 55.0
    credit_max_bb_width_pct: 3.0
    vix_ticker: "^INDIAVIX"
    vix_credit_min: 14.0
    vix_credit_max: 24.0
    vix_no_credit_below: 14.0
    vix_half_size_above: 28.0
    macro_event_override: false
    # Section 3B — Iron condor
    ic_widths: [50, 100]
    ic_min_credit_pct_width: 35.0
    ic_max_risk_reward: 2.0
    ic_short_delta_min: 0.12
    ic_short_delta_max: 0.18
    ic_breakeven_expected_move_mult: 1.3
    # Section 3C — Credit stop loss
    credit_sl_multiplier: 1.8
    delta_adjustment_threshold: 0.25
    delta_exit_threshold: 0.30
    # Section 4 — Hedged strangle
    strangle_min_iv_percentile: 65.0
    strangle_vix_min: 16.0
    strangle_vix_max: 22.0
    strangle_delta_min: 0.10
    strangle_delta_max: 0.15
    strangle_min_credit_pct_spot: 2.0
    strangle_wing_offset: 200
    # Section 5 — Debit spread
    debit_max_iv_percentile: 40.0
    debit_min_risk_reward: 2.0
    debit_max_risk_pct: 0.4
    debit_max_sessions: 3
    debit_sl_premium_loss_pct: 50.0
    # Section 7 — Liquidity
    min_oi: 15000
    min_volume: 2000
    max_bid_ask_pct: 3.0
    slippage_per_leg: 0.05
    post_fill_max_rr: 2.0
    # Section 8 — Portfolio
    max_open_positions: 4
  jarvis:
    enabled: true
    display_name: "V2 Jarvis"
    # Capital
    initial_capital: 5000000
    lot_size: 65
    # Risk limits
    max_capital_risk_per_trade_pct: 1.0      # 1% of account per trade
    max_margin_utilization_pct: 30.0
    daily_loss_shutdown_pct: 2.0              # full shutdown threshold
    max_open_positions: 5
    max_positions_per_direction: 2
    vix_spread_only_threshold: 28.0          # VIX above this → spreads only
    expiry_day_cutoff_time: "13:30"          # no new trades after this on expiry
    # Credit strategy rules
    credit_max_risk_reward: 2.5              # reject if RR > 2.5
    strangle_min_credit_pct_spot: 2.0        # credit ≥ 2% of spot
    strangle_delta_min: 0.12
    strangle_delta_max: 0.20
    spread_widths: [50, 100]                 # allowed spread widths in points
    spread_min_credit_pct_width: 30.0        # credit ≥ 30% of width
    credit_sl_multiplier: 2.2                # exit at 2.2× credit
    strangle_leg_double_exit: true
    strangle_delta_exit_threshold: 0.35
    strangle_total_loss_multiplier: 1.2
    # Debit strategy rules
    debit_min_risk_reward: 1.8               # RR ≥ 1:1.8
    debit_min_pop_pct: 40.0                  # POP ≥ 40%
    debit_sl_premium_loss_pct: 50.0
    debit_max_sessions: 3
    # Liquidity thresholds
    min_oi: 10000
    min_volume: 1000
    max_bid_ask_pct: 5.0
    # IV percentile thresholds
    credit_min_iv_percentile: 50.0
    debit_max_iv_percentile: 50.0
    # Portfolio defense
    consecutive_loss_half_size: 2
    consecutive_loss_halt: 3
    # Execution
    slippage_per_leg: 0.05                   # ₹0.05 per leg (1 tick)
  atlas:
    enabled: true
    display_name: "V4 Atlas"
    # Capital
    initial_capital: 5000000
    lot_size: 65
    # Regime thresholds (tuned via scripts/tune_vol_params.py)
    regime_sell_vrp_min: 0.45
    regime_sell_vov_max: 0.75
    standdown_vov_min: 0.75
    standdown_rv_min: 0.90
    # Dynamic function coefficients — strike delta
    strike_delta_base: 0.20
    strike_delta_coeff: 0.08
    # Dynamic function coefficients — min credit ratio
    credit_ratio_base: 0.24
    credit_ratio_coeff: 0.18
    # Dynamic function coefficients — SL multiple
    sl_multiple_base: 1.4
    sl_multiple_coeff: 0.6
    # Dynamic function coefficients — delta exit
    delta_exit_base: 0.22
    delta_exit_coeff: 0.10
    # Dynamic function coefficients — take profit
    take_profit_base: 0.45
    take_profit_coeff: 0.20
    # Dynamic function coefficients — breakeven coverage
    breakeven_mult_base: 1.20
    breakeven_mult_coeff: 0.35
    # Dynamic function coefficients — risk per trade
    risk_per_trade_base_pct: 0.50
    risk_per_trade_rv_coeff: 0.5
    risk_per_trade_vov_coeff: 0.5
    # Dynamic function coefficients — max portfolio risk
    max_portfolio_risk_base_pct: 3.0
    max_portfolio_risk_coeff: 0.5
    # Hard gates (same as V3)
    max_margin_utilization_pct: 25.0
    daily_loss_shutdown_pct: 1.25
    weekly_drawdown_shutdown_pct: 2.0
    consecutive_loss_reduce_threshold: 3
    consecutive_loss_halt: 5
    # Portfolio structure
    max_open_positions: 4
    max_iron_condors: 3
    max_directional_positions: 1
    primary_allocation_pct: 80.0
    secondary_allocation_pct: 20.0
    # Trade construction — IC
    ic_widths: [50, 100]
    ic_max_risk_reward: 2.0
    # Trade construction — Hedged strangle
    strangle_wing_offset: 200
    strangle_min_credit_pct_spot: 2.0
    # Trade construction — Debit spread
    debit_min_risk_reward: 2.0
    debit_max_risk_pct: 0.4
    debit_max_sessions: 3
    debit_sl_premium_loss_pct: 50.0
    # Liquidity
    min_oi: 15000
    min_volume: 2000
    max_bid_ask_pct: 3.0
    slippage_per_leg: 0.05
    post_fill_max_rr: 2.0
    # VIX
    vix_ticker: "^INDIAVIX"
    # Macro events
    macro_event_override: false

criticizer:
  enabled: true
  auto_critique: true
  min_trades_for_override: 3
  max_parameter_drift_pct: 0.30
  override_min_confidence: 0.7

self_improvement:
  enabled: true
  min_sample_size: 15          # Min trades before allowing a param change
  max_step_pct: 0.15           # Max 15% change per review cycle
  max_drift_pct: 0.40          # Max 40% cumulative drift from default
  cooling_period_trades: 10    # Trades to wait after a change before re-evaluating
  reversion_trigger_losses: 5  # Consecutive losses to trigger reversion flag
  max_changes_per_session: 3   # Max param changes per review session
  rolling_window_days: 20      # Rolling window for signal reliability analysis

context_engine:
  bootstrap_days: 60             # Days of daily candles to fetch on startup
  daily_candle_ticker: "^NSEI"   # yfinance ticker for daily candles
  session_context_enabled: true
  daily_context_enabled: true
  weekly_context_enabled: true
  vol_context_enabled: true

