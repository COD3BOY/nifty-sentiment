# NIFTY Sentiment Prediction System Configuration

sources:
  gift_nifty:
    enabled: true
    weight: 2.5
    timeout: 30
    description: "GIFT Nifty pre-market gap"
    gap_pct_scale: 2.0  # 1% gap maps to 0.5 score

  zerodha_pulse:
    enabled: true
    weight: 2.0
    timeout: 30
    description: "News sentiment via Zerodha Pulse"
    max_headlines: 20
    rss_url: "https://pulse.zerodha.com/feed.php"

  global_markets:
    enabled: true
    weight: 2.0
    timeout: 30
    description: "S&P 500, Nikkei, Hang Seng, FTSE"
    indices:
      "^GSPC": { name: "S&P 500", weight: 1.0 }
      "^N225": { name: "Nikkei 225", weight: 0.7 }
      "^HSI": { name: "Hang Seng", weight: 0.7 }
      "^FTSE": { name: "FTSE 100", weight: 0.5 }

  fii_dii:
    enabled: true
    weight: 1.8
    timeout: 30
    description: "FII/DII institutional flows"
    significant_flow_cr: 2000
    fii_weight: 0.7
    dii_weight: 0.3

  vix:
    enabled: true
    weight: 1.5
    timeout: 30
    description: "India VIX fear gauge"
    ticker: "^INDIAVIX"
    spike_threshold: 10  # % day-over-day rise
    spike_amplification: 0.3

  crude_oil:
    enabled: true
    weight: 1.0
    timeout: 30
    description: "Brent crude + USD/INR"
    crude_ticker: "BZ=F"
    inr_ticker: "INR=X"
    crude_weight: 0.6
    inr_weight: 0.4

  youtube:
    enabled: false
    weight: 0.8
    timeout: 60
    description: "YouTube financial advisor sentiment"
    channels:
      - "CA Rachana Ranade"
      - "Akshat Shrivastava"
      - "Pranjal Kamra"

  reddit:
    enabled: false
    weight: 0.5
    timeout: 30
    description: "r/IndianStreetBets sentiment"
    subreddit: "IndianStreetBets"
    post_limit: 25
    confidence_discount: 0.7

engine:
  default_timeout: 30
  nifty_ticker: "^NSEI"
  sentiment_levels:
    strongly_bearish: -0.6
    bearish: -0.3
    slightly_bearish: -0.1
    neutral_low: -0.1
    neutral_high: 0.1
    slightly_bullish: 0.1
    bullish: 0.3
    strongly_bullish: 0.6

database:
  path: "data/nifty_sentiment.db"

claude:
  model: "claude-sonnet-4-5-20250929"
  max_tokens: 4096

pre_market:
  weights:
    gift_nifty: 3.0
    global_markets: 2.5
    zerodha_pulse: 2.0
    fii_dii: 1.8
    vix: 1.5
    crude_oil: 1.0

options_desk:
  symbol: "NIFTY"
  nifty_ticker: "^NSEI"
  candles:
    period: "5d"
    interval: "5m"
  indicators:
    ema_fast: 9
    ema_mid: 21
    ema_slow: 50
    rsi_period: 9
    supertrend_period: 10
    supertrend_multiplier: 3.0
    bb_period: 20
    bb_std: 2.0
  iv_calculator:
    risk_free_rate: 0.065    # RBI repo rate (annual, decimal)
    atm_range: 15            # Compute IV for ± this many strikes around ATM
  signal_thresholds:
    rsi_overbought: 70
    rsi_oversold: 30
    pcr_bullish: 1.2
    pcr_bearish: 0.7
    iv_high: 18
    iv_low: 10
  trade_suggestions:
    lot_size: 65
    otm_offset: 2
    spread_width: 2
    min_score: 40

paper_trading:
  initial_capital: 5000000
  lot_size: 65
  auto_execute: true
  min_score_to_trade: 50
  trade_cooldown_seconds: 60
  max_lots: 4
  capital_utilization: 0.70
  daily_loss_limit_pct: 3.0
  debit_max_hold_minutes: 120
  eod_close_time: "15:20"
  entry_start_time: "10:00"         # Warmup 9:15-10:00 — collect data before trading
  entry_cutoff_time: "15:10"
  max_open_positions: 3
  max_positions_per_direction: 2
  max_staleness_minutes: 20
  slippage_per_leg: 3.0
  stop_loss:
    credit_fallback_multiplier: 2.0
    debit_premium_pct: 0.40
  profit_target:
    credit_pct: 0.30
    debit_pct: 0.50
  execution_cost:
    brokerage_per_order: 20
    stt_sell_pct: 0.001
    exchange_txn_pct: 0.00035
    sebi_turnover_pct: 0.000001    # ₹10/crore on total turnover
    gst_pct: 0.18
    stamp_duty_buy_pct: 0.00003
  expiry_guards:
    no_new_after_minutes_before_close: 30   # Don't open positions in last 30min on expiry day
    min_leg_premium: 2.0                    # Skip legs with LTP < ₹2
    min_net_premium_per_lot: 100            # Skip if |net premium| per lot < ₹100

  margin_estimates:
    short_straddle: 150000
    short_strangle: 135000
    bull_put_spread: 65000
    bear_call_spread: 65000
    bull_call_spread: 0
    bear_put_spread: 0
    iron_condor: 45000
    long_call_ce: 0
    long_put_pe: 0
    long_straddle: 0
    long_strangle: 0

algorithms:
  sentinel:
    enabled: true
    display_name: "V1 Sentinel"
  institutional:
    enabled: true
    display_name: "V2 Institutional"
    # Risk limits
    max_capital_risk_per_trade_pct: 1.0      # 1% of account per trade
    max_margin_utilization_pct: 30.0
    daily_loss_shutdown_pct: 2.0              # full shutdown threshold
    max_open_positions: 5
    max_positions_per_direction: 2
    vix_spread_only_threshold: 28.0          # VIX above this → spreads only
    expiry_day_cutoff_time: "13:30"          # no new trades after this on expiry
    # Credit strategy rules
    credit_max_risk_reward: 2.5              # reject if RR > 2.5
    strangle_min_credit_pct_spot: 2.0        # credit ≥ 2% of spot
    strangle_delta_min: 0.12
    strangle_delta_max: 0.20
    spread_widths: [50, 100]                 # allowed spread widths in points
    spread_min_credit_pct_width: 30.0        # credit ≥ 30% of width
    credit_sl_multiplier: 2.2                # exit at 2.2× credit
    strangle_leg_double_exit: true
    strangle_delta_exit_threshold: 0.35
    strangle_total_loss_multiplier: 1.2
    # Debit strategy rules
    debit_min_risk_reward: 1.8               # RR ≥ 1:1.8
    debit_min_pop_pct: 40.0                  # POP ≥ 40%
    debit_sl_premium_loss_pct: 50.0
    debit_max_sessions: 3
    # Liquidity thresholds
    min_oi: 10000
    min_volume: 1000
    max_bid_ask_pct: 5.0
    # IV percentile thresholds
    credit_min_iv_percentile: 50.0
    debit_max_iv_percentile: 50.0
    # Portfolio defense
    consecutive_loss_half_size: 2
    consecutive_loss_halt: 3
    # Execution
    slippage_per_leg: 0.05                   # ₹0.05 per leg (1 tick)

criticizer:
  enabled: true
  auto_critique: true
  min_trades_for_override: 3
  max_parameter_drift_pct: 0.30
  override_min_confidence: 0.7

